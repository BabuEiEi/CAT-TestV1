<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CAT + Item Pool (Front-end Only)</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Font -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600;700&display=swap" rel="stylesheet" />
  <style>
    body { font-family: 'Sarabun', sans-serif; }
  </style>

  <!-- Utilities -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.4.21/mammoth.browser.min.js"></script>
</head>
<body class="bg-gray-50 min-h-screen">
  <header class="bg-white shadow sticky top-0 z-40">
    <div class="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <img src="./assets/logo.png" alt="logo" class="w-9 h-9" />
        <h1 class="text-lg font-bold">CAT + Item Pool</h1>
      </div>
      <nav class="flex items-center gap-4 text-sm">
        <a href="#home" class="hover:underline">หน้าแรก</a>
        <a href="#practice" class="hover:underline">ทำแบบฝึกหัด</a>
        <a href="#admin" id="navAdmin" class="hover:underline hidden">Item Pool (Admin)</a>
        <a href="#stats" class="hover:underline">พัฒนาการ</a>
        <span id="userBox" class="text-gray-600"></span>
        <button id="btnLogin" class="px-3 py-1 rounded bg-indigo-600 text-white">เข้าสู่ระบบ</button>
        <button id="btnLogout" class="px-3 py-1 rounded bg-red-600 text-white hidden">ออกจากระบบ</button>
      </nav>
    </div>
  </header>

  <main class="max-w-6xl mx-auto p-4 space-y-12">
    <!-- Home -->
    <section id="home" class="bg-white rounded-xl p-6 shadow">
      <h2 class="text-xl font-semibold mb-3">Computerized Adaptive Testing (CAT)</h2>
      <p class="text-gray-700">ระบบฝึกทำข้อสอบแบบปรับตามความสามารถ ใช้ Item Pool ที่นำเข้าจาก DOCX/CSV และบันทึกผลด้วย Firebase</p>
    </section>

    <!-- Practice -->
    <section id="practice" class="bg-white rounded-xl p-6 shadow">
      <h2 class="text-xl font-semibold mb-4">ทำแบบฝึกหัด</h2>
      <div class="grid md:grid-cols-2 gap-4">
        <div>
          <label class="block text-sm">โหมด</label>
          <select id="modeSelect" class="mt-1 w-full border rounded p-2">
            <option value="fixed">Fixed (สุ่มตามช่วงดาว)</option>
            <option value="cat">CAT (หยุดตาม SE)</option>
          </select>
        </div>
        <div>
          <label class="block text-sm">จำนวนข้อ (maxItems)</label>
          <input id="numItems" type="number" min="3" max="40" value="10" class="mt-1 w-full border rounded p-2" />
        </div>
        <div>
          <label class="block text-sm">ช่วงระดับดาว (1–6)</label>
          <div class="flex items-center gap-2 mt-1">
            <input id="minStar" type="range" min="1" max="6" value="1" />
            <span id="minStarVal" class="w-6 text-center">1</span>
            <span>—</span>
            <input id="maxStar" type="range" min="1" max="6" value="6" />
            <span id="maxStarVal" class="w-6 text-center">6</span>
          </div>
        </div>
        <div id="catOnly" class="hidden">
          <label class="block text-sm">เกณฑ์หยุด SE(θ) (targetSE)</label>
          <input id="targetSE" type="number" step="0.01" min="0.2" max="0.7" value="0.35" class="mt-1 w-full border rounded p-2" />
        </div>
      </div>
      <div class="mt-4">
        <button id="btnStartPractice" class="px-4 py-2 rounded bg-green-600 text-white">เริ่มทำ</button>
      </div>
      <div id="practiceArea" class="mt-6"></div>
    </section>

    <!-- Admin -->
    <section id="admin" class="bg-white rounded-xl p-6 shadow hidden">
      <h2 class="text-xl font-semibold mb-4">Item Pool (Admin)</h2>
      <div class="flex flex-wrap items-center gap-3 mb-4">
        <label class="px-3 py-2 border rounded cursor-pointer bg-gray-100">นำเข้า DOCX
          <input id="docxInput" type="file" accept=".docx" class="hidden" />
        </label>
        <label class="px-3 py-2 border rounded cursor-pointer bg-gray-100">นำเข้า CSV
          <input id="csvInput" type="file" accept=".csv" class="hidden" />
        </label>
        <button id="btnApproveAll" class="px-3 py-2 rounded bg-indigo-600 text-white">อนุมัติทั้งหมด</button>
        <button id="btnClearAll" class="px-3 py-2 rounded bg-red-600 text-white">ล้างคลังข้อสอบ</button>
      </div>
      <div id="adminList" class="text-sm"></div>
    </section>

    <!-- Stats -->
    <section id="stats" class="bg-white rounded-xl p-6 shadow">
      <h2 class="text-xl font-semibold mb-3">พัฒนาการของฉัน</h2>
      <div class="bg-white rounded-xl p-4 border">
        <canvas id="thetaChart" height="140"></canvas>
      </div>
      <div class="flex items-center gap-3 mt-3">
        <button id="btnExportPDF" class="px-4 py-2 rounded bg-indigo-600 text-white">Export รายงาน PDF</button>
        <div class="text-sm text-gray-600">รวมกราฟ θ & SE และสรุปครั้งล่าสุด</div>
      </div>
      <div id="attemptList" class="mt-4"></div>
    </section>
  </main>

  <footer class="py-8 text-center text-xs text-gray-500">© CAT + Item Pool Demo</footer>

  <!-- โมดูลหลัก (ลำดับสำคัญ) -->
  <script type="module" src="./config.js"></script>
  <script type="module" src="./firebase.js"></script>
  <script type="module" src="./ui.js"></script>
  <script type="module" src="./auth.js"></script>
  <script type="module" src="./parser.js"></script>
  <script type="module" src="./admin.js"></script>
  <script type="module" src="./practice.js"></script>
  <script type="module" src="./stats.js"></script>
</body>
</html>
